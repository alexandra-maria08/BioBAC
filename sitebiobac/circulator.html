<!DOCTYPE html>

<html lang="ro">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link rel="manifest" href="/manifest.json">
<title>BioBAC – Sistemul circulator</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Activare dark mode din localStorage -->
<script>
    if (localStorage.getItem('tema') === 'dark') {
      document.documentElement.classList.add('dark');
    }
</script>
<style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff8e1;
      margin: 0;
      padding: 20px;
      color: #000;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    h1, h2 { color: #ff6f00; }
    ul { text-align: left; }
    .intrebare { margin: 15px 0; text-align: left; }
    .raspunsuri button {
      width: 100%;
      margin: 5px 0;
      padding: 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #f0f0f0;
      color: #000;
      transition: background-color 0.3s ease;
    }
    .raspunsuri button.corect {
      background-color: #c8e6c9;
      color: #2e7d32;
      border: none;
    }
    .raspunsuri button.gresit {
      background-color: #ffcdd2;
      color: #c62828;
      border: none;
    }
    .feedback { font-weight: bold; margin-top: 10px; }
    input[type=text], select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
    }
    a.back {
      display: inline-block;
      margin-top: 20px;
      color: #ff6f00;
      font-weight: bold;
      text-decoration: none;
    }
    .rezultat {
      background-color: #fff9c4;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 18px;
    }

    /* Google Translate container */
    #google_translate_element {
      position: absolute;
      top: 15px;
      right: 20px;
      z-index: 10;
      text-align: right;
    }

    /* DARK MODE */
    .dark body, .dark {
      background-color: #121212 !important;
      color: #e0e0e0 !important;
    }
    .dark .container {
      background-color: #1e1e1e !important;
      box-shadow: 0 0 10px rgba(255,255,255,0.1) !important;
    }
    .dark .raspunsuri button {
      background-color: #2c2c2c !important;
      color: white !important;
    }
    .dark .raspunsuri button.corect {
      background-color: #388e3c !important;
      color: white !important;
      border: none !important;
    }
    .dark .raspunsuri button.gresit {
      background-color: #d32f2f !important;
      color: white !important;
      border: none !important;
    }
    .dark .rezultat { background-color: #333 !important; }
    .dark a.back { color: #ffcc80 !important; }

    /* Google Translate styling */
    .goog-te-banner-frame.skiptranslate {
      display: none !important;
    }
    body { top: 0 !important; }

    #google_translate_element {
      margin-top: 5px;
    }

    #tts-button {
      background-color: #ff6f00;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: bold;
      margin: 10px 0;
    }
    .dark #tts-button {
      background-color: #ffcc80;
      color: #121212;
    }

    .info-box {
      background-color: #fff8e1;
      border-left: 4px solid #ff6f00;
      padding: 15px;
      margin: 15px 0;
      border-radius: 5px;
    }
    .dark .info-box {
      background-color: #2d2d2d;
      border-left-color: #ffcc80;
    }
  </style>
<script async="" data-goatcounter="https://biobac.goatcounter.com/count" src="//gc.zgo.at/count.js"></script>
</head>
<body>
<div class="container">

  <!-- Google Translate -->
  <div id="google_translate_element"></div>

  <div style="display: flex; justify-content: space-between; align-items: flex-start;">
    <button id="tts-button" title="Ascultă teoria esențială">🔊 Ascultă</button>
    <div id="google_translate_element"></div>
  </div>

<h1>❤️ BioBAC – Sistemul circulator</h1>

<h2>🧠 Teorie esențială</h2>
<div id="teorie-esentiala">
<ul>
<li>Sistemul circulator transportă substanțele necesare și deșeurile metabolice în organism.</li>
<li>Componente:
        <ul>
<li><strong>Inima</strong>: pompă musculară cu 4 camere (2 atrii și 2 ventricule)</li>
<li><strong>Vasele de sânge</strong>: artere, vene, capilare</li>
<li><strong>Sângele</strong>: conține celule (eritrocite, leucocite, trombocite) și plasmă</li>
</ul>
</li>
<li>Sângele oxigenat circulă prin artere, cel dezoxigenat prin vene (cu excepții).</li>
<li>Ciclul cardiac durează aproximativ <strong>0,8 secunde</strong> la adult.</li>
<li><strong>Circulația dublă</strong>: mică (inimă-plămâni) și mare (inimă-corp).</li>
<li>Arterele au pereți groși și elastici, venele au <strong>valve</strong>.</li>
<li>Capilarele permit schimbul de substanțe între sânge și țesuturi.</li>
<li>Volumul total de sânge la adult este aproximativ <strong>5 litri</strong>.</li>
<li><strong>Pulsul</strong> reprezintă bătăile inimii - normal 60-100/min.</li>
<li>Eritrocitele transportă oxigenul cu ajutorul <strong>hemoglobinei</strong>.</li>
<li>Leucocitele asigură <strong>apărarea imunitară</strong> a organismului.</li>
</ul>
</div>

<h2>📝 Test – 9 itemi</h2>
<div class="intrebare">
<p><strong>1. Ce cameră a inimii primește sângele oxigenat de la plămâni?</strong></p>
<div class="raspunsuri">
<button onclick="verifica(this, true)">Atriu stâng</button>
<button onclick="verifica(this, false)">Ventricul drept</button>
<button onclick="verifica(this, false)">Atriu drept</button>
<button onclick="verifica(this, false)">Ventricul stâng</button>
</div>
</div>
<div class="intrebare">
<p><strong>2. Ce tip de vase transportă sânge de la inimă către țesuturi?</strong></p>
<div class="raspunsuri">
<button onclick="verifica(this, true)">Artere</button>
<button onclick="verifica(this, false)">Vene</button>
<button onclick="verifica(this, false)">Capilare</button>
<button onclick="verifica(this, false)">Limfatice</button>
</div>
</div>
<div class="intrebare">
<p><strong>3. Completează: Celulele roșii se mai numesc __________.</strong></p>
<input id="c1" type="text"/><button onclick="verificaCompletare('c1', 'eritrocite')">Verifică</button>
<p class="feedback" id="f1"></p>
</div>
<div class="intrebare">
<p><strong>4. Alege componente ale sistemului circulator:</strong></p>
<label><input id="cb1" type="checkbox"/> Inima</label><br/>
<label><input id="cb2" type="checkbox"> Artere</input></label><br/>
<label><input id="cb3" type="checkbox"/> Ficatul</label><br/>
<label><input id="cb4" type="checkbox"/> Sângele</label><br/>
<button onclick="verificaCheckbox()">Verifică</button>
<p class="feedback" id="f2"></p>
</div>
<div class="intrebare">
<p><strong>5. Completează: Capilarele permit schimbul de __________ între sânge și celule.</strong></p>
<input id="c2" type="text"/><button onclick="verificaCompletare('c2', 'substanțe')">Verifică</button>
<p class="feedback" id="f3"></p>
</div>
<div class="intrebare">
<p><strong>6. Ce este circulația dublă?</strong></p>
<input id="r1" type="text"/><button onclick="verificaScurt()">Verifică</button>
<p class="feedback" id="f4"></p>
</div>
<div class="intrebare">
<p><strong>7. Asociază fiecare vas cu funcția sa:</strong></p>
<label>Arteră →
        <select id="a1">
<option value="">Selectează</option>
<option value="departe">Transport sânge de la inimă</option>
<option value="spre">Transport sânge spre inimă</option>
</select>
</label><br/>
<label>Venă →
        <select id="a2">
<option value="">Selectează</option>
<option value="departe">Transport sânge de la inimă</option>
<option value="spre">Transport sânge spre inimă</option>
</select>
</label><br/>
<button onclick="verificaAsociere()">Verifică</button>
<p class="feedback" id="f5"></p>
</div>
<div class="intrebare">
<p><strong>8. Completează: Sângele conține plasmă și __________.</strong></p>
<input id="c3" type="text"/><button onclick="verificaCompletare('c3', 'celule')">Verifică</button>
<p class="feedback" id="f6"></p>
</div>
<div class="intrebare">
<p><strong>9. Ce structură împiedică refluxul sângelui în inimă?</strong></p>
<div class="raspunsuri">
<button onclick="verifica(this, false)">Atrii</button>
<button onclick="verifica(this, false)">Vene</button>
<button onclick="verifica(this, false)">Artere</button>
<button onclick="verifica(this, true)">Valvele</button>
</div>
</div>
<button onclick="afiseazaFeedbackFinal()">✅ Vezi rezultatul final</button>
<p class="rezultat" id="rezultatFinal"></p>
<a class="back" href="index.html">← Înapoi la meniu</a>
</div>

<script>
    let scor = 0;
    let completari = {};

    function verifica(elem, corect) {
      elem.disabled = true;
      elem.classList.remove('corect', 'gresit');
      elem.classList.add(corect ? 'corect' : 'gresit');
      elem.parentElement.querySelectorAll('button').forEach(b => b.disabled = true);
      if (corect) scor++;
    }

    function verificaCompletare(id, rasp) {
      const val = document.getElementById(id).value.trim().toLowerCase();
      const f = document.getElementById('f' + id.slice(1));
      const esteCorect = val === rasp.toLowerCase();
      f.innerText = esteCorect ? '✔️ Corect' : `❌ Răspuns corect: ${rasp}`;
      f.style.color = esteCorect ? 'green' : 'red';
      if (!completari[id] && esteCorect) { scor++; completari[id] = true; }
    }

    function verificaCheckbox() {
      const corect = [true, true, false, true];
      const selectat = [cb1.checked, cb2.checked, cb3.checked, cb4.checked];
      const f = document.getElementById('f2');
      const esteCorect = JSON.stringify(corect) === JSON.stringify(selectat);
      f.innerText = esteCorect ? '✔️ Corect' : '❌ Componentele corecte: inima, artere, sânge.';
      f.style.color = esteCorect ? 'green' : 'red';
      if (esteCorect && !completari['checkbox']) { scor++; completari['checkbox'] = true; }
    }

    function verificaScurt() {
      const val = document.getElementById('r1').value.trim().toLowerCase();
      const f = document.getElementById('f4');
      const conditii = ['mică', 'mare', 'inimă'];
      const esteCorect = conditii.every(cuv => val.includes(cuv));
      if (esteCorect) {
        f.innerText = '✔️ Corect';
        f.style.color = 'green';
        if (!completari['scurt']) { scor++; completari['scurt'] = true; }
      } else {
        f.innerText = '❌ Exemplu: Circulația dublă înseamnă că sângele trece de două ori prin inimă: o dată prin circulația mică (plămâni) și o dată prin circulația mare (corp).';
        f.style.color = 'red';
      }
    }

    function verificaAsociere() {
      const a1 = document.getElementById('a1').value;
      const a2 = document.getElementById('a2').value;
      const f = document.getElementById('f5');
      const esteCorect = a1 === 'departe' && a2 === 'spre';
      f.innerText = esteCorect ? '✔️ Corect' : '❌ Arteră → de la inimă, Venă → spre inimă';
      f.style.color = esteCorect ? 'green' : 'red';
      if (esteCorect && !completari['asociere']) { scor++; completari['asociere'] = true; }
    }

    async function adaugaXP(puncte) {
      const user = auth.currentUser;
      if (!user) {
        console.log("Nu ești logat, nu se poate salva progresul.");
        return;
      }
      const uid = user.uid;
      const docRef = db.collection("progres_utilizatori").doc(uid);
      try {
        const doc = await docRef.get();
        if (!doc.exists) {
          await docRef.set({ nivel: 1, xp: 0 });
        }
        let data = (await docRef.get()).data();
        let xp = data.xp || 0;
        let nivel = data.nivel || 1;
        const maxXp = nivel * 100;

        xp += puncte;

        if (xp >= maxXp) {
          nivel++;
          xp = xp - maxXp;
          alert(`Felicitări! Ai urcat la nivelul ${nivel}!`);
        }

        await docRef.update({ nivel, xp });
        console.log(`Progres salvat: Nivel ${nivel}, XP ${xp}/${nivel*100}`);
      } catch (e) {
        console.error("Eroare salvare progres:", e);
      }
    }

    function afiseazaFeedbackFinal() {
      const procent = (scor / 9) * 100;
      let mesaj = '';
      if (procent >= 90) mesaj = '🌟 Excelent! Ai înțeles foarte bine materia!';
      else if (procent >= 70) mesaj = '👍 Bine! Mai exersează câteva concepte.';
      else if (procent >= 50) mesaj = '🙂 Mai este loc de îmbunătățire. Recitește lecția.';
      else mesaj = '⚠️ Îți recomandăm să reiei teoria pas cu pas.';
      document.getElementById('rezultatFinal').innerText = `${mesaj} Ai obținut ${scor} din 9 răspunsuri corecte.`;

      const xpDeAdaugat = scor * 10; // 10 XP pe răspuns corect
      adaugaXP(xpDeAdaugat);
    }

    // Google Translate init
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'ro',
        includedLanguages: 'en,hu',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }

    // Service Worker (PWA)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js")
        .then(reg => console.log("✅ Service Worker activat!", reg))
        .catch(err => console.error("❌ Eroare la SW:", err));
    }

    // Firebase config și inițializare
    const firebaseConfig = {
      apiKey: "AIzaSyA5C-UQTHOO7CFrbzV7vMXfQTrM1iz0_CE",
      authDomain: "biobac-cont.firebaseapp.com",
      projectId: "biobac-cont",
      storageBucket: "biobac-cont.appspot.com",
      messagingSenderId: "59421729279",
      appId: "1:59421729279:web:142fbafcc1f22c9b5ac7ca"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Text-to-Speech (TTS)
    const ttsButton = document.getElementById('tts-button');
    let synth = window.speechSynthesis;
    let voceCitita = false;

    ttsButton.addEventListener('click', () => {
      if (voceCitita) {
        synth.cancel();
        ttsButton.textContent = "🔊 Ascultă";
        voceCitita = false;
      } else {
        let text = document.getElementById('teorie-esentiala').innerText;
        let utterThis = new SpeechSynthesisUtterance(text);
        utterThis.lang = 'ro-RO';
        utterThis.rate = 1;
        utterThis.pitch = 1;
        utterThis.onend = () => {
          ttsButton.textContent = "🔊 Ascultă";
          voceCitita = false;
        };
        synth.speak(utterThis);
        ttsButton.textContent = "⏸️ Oprește";
        voceCitita = true;
      }
    });
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script src="settings.js"></script>
</body>
</html>